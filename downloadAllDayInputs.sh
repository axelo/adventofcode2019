#!/usr/bin/env bash

SESSION="$1"
OUTJSON="$2"
DAYS=7

if [ "$SESSION" == "" ] || [ "${OUTJSON}" == "" ]; then
    echo "Must be called with a session and output value"
    exit 1
fi

echo -e "-- Autogenerated\n\n\nmodule Inputs exposing (..)" > ${OUTJSON}

echo -e "\n\ndays : List String" >> ${OUTJSON}
echo "days =" >> ${OUTJSON}
echo "    [ day1" >> ${OUTJSON}

for i in $(seq 2 $DAYS); do
    echo "    , day$i" >> ${OUTJSON}
done

echo "    ]" >> ${OUTJSON}


for i in $(seq 1 $DAYS); do
    # INPUT=`curl --silent --show-error --fail -b "session=$SESSION" "https://adventofcode.com/2019/day/$i/input" | jq -R -s`
    INPUT=`curl --silent --show-error --fail -b "session=$SESSION" "https://adventofcode.com/2019/day/$i/input"`

    if [ $? == 0 ]; then
        echo "Got input for day $i"
        echo -e "\n\nday$i : String" >> ${OUTJSON}
        echo "day$i = " >> ${OUTJSON}
        echo -n "    \"\"\"" >> ${OUTJSON}
        echo -ne "${INPUT}" >> ${OUTJSON}
        echo "\"\"\"" >> ${OUTJSON}

    else
        echo "Failed to download puzzle input for day $i"
        exit 2
    fi

    sleep 1
done

